<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema CED BRASIL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="icon" href="../favicon.jpg" type="image/jpeg" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            line-height: 1.6;
        }
        h1, h2 {
            font-family: 'Poppins', sans-serif;
            color: #f5f5f5;
        }
        .spotify-green { color: #1db954; }
        .bg-spotify-green { background-color: #1db954; }
        .hover-bg-spotify-green-darker:hover { background-color: #1aa34a; }
  .scroll-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background-color: #1db954;
    color: #000;
    border-radius: 9999px;
    padding: 0.75rem 1rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    opacity: 0;
    transform: scale(0);
    transition: opacity 0.3s, transform 0.3s;
    pointer-events: none;
    z-index: 1000;
  }
  .scroll-to-top.show {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
  }
    </style>
</head>
<body>
    <div id="login-section" class="min-h-screen flex items-center justify-center">
        <form id="loginForm" class="bg-gray-800 p-8 rounded-md shadow-md w-full max-w-sm">
            <h1 class="text-2xl font-bold mb-6 text-center">Acessar Sistema</h1>
            <div class="mb-4">
                <label for="username" class="block mb-2 text-sm">Usu√°rio</label>
                <input type="text" id="username" class="w-full px-4 py-2 rounded bg-gray-700 text-white focus:outline-none" placeholder="Login" required />
            </div>
            <div class="mb-6">
                <label for="password" class="block mb-2 text-sm">Senha</label>
                <input type="password" id="password" class="w-full px-4 py-2 rounded bg-gray-700 text-white focus:outline-none" placeholder="Senha" required />
            </div>
            <button type="submit" class="w-full bg-spotify-green text-black font-bold py-2 rounded hover-bg-spotify-green-darker transition-colors">Entrar</button>
            <p id="loginError" class="mt-4 text-red-500 text-center hidden">Usu√°rio ou senha incorretos.</p>
        </form>
    </div>
    <div id="system-section" class="hidden min-h-screen">
        <div class="flex h-full">
            <aside class="w-60 bg-gray-900 p-4 space-y-4">
                <h2 class="text-xl font-bold">Painel</h2>
                <nav class="space-y-2">
                    <button id="menu-alunos" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700">Alunos</button>
                </nav>
            </aside>
            <main id="main-content" class="flex-1 p-6 overflow-auto">
                <section id="alunos-section" class="hidden">
                    <h2 class="text-2xl font-bold mb-4">Alunos</h2>
                    <div class="mb-4 flex items-center">
                        <input id="aluno-filtro" type="text" placeholder="Filtrar por nome" class="px-4 py-2 rounded bg-gray-700 text-white focus:outline-none" />
                        <button id="buscar-alunos" class="ml-2 bg-spotify-green text-black px-4 py-2 rounded hover-bg-spotify-green-darker">Buscar</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-gray-800 rounded">
                            <thead>
                                <tr class="bg-gray-700">
                                    <th class="px-4 py-2 text-left">
                                        <input type="checkbox" id="select-all" />
                                    </th>
                                    <th class="px-4 py-2 text-left">ID</th>
                                    <th class="px-4 py-2 text-left">Nome</th>
                                    <th class="px-4 py-2 text-left">E-mail</th>
                                    <th class="px-4 py-2 text-left">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="alunos-tabela"></tbody>
                        </table>
                    </div>
                </section>
                <div id="welcome-section" class="flex items-center justify-center h-full">
                    <h2 class="text-2xl">Selecione uma op√ß√£o no menu.</h2>
                </div>
            </main>
        </div>
        <div id="acoes-drawer" class="hidden fixed bottom-0 left-0 right-0 bg-gray-900 p-4 flex justify-end">
            <button id="excluir-selecionados" class="bg-red-600 text-white px-4 py-2 rounded">Excluir Selecionados</button>
        </div>
    </div>
    <footer class="bg-[#181818] text-center py-6 mt-12">
        <details class="max-w-4xl mx-auto text-left text-sm text-gray-300 space-y-2 bg-gray-800/50 p-4 rounded-lg group">
            <summary class="text-xl font-semibold text-white mb-2 text-center cursor-pointer flex items-center justify-between">
                <span>üìö Pol√≠ticas da CED BRASIL</span>
                <i class="fas fa-chevron-down transition-transform group-open:rotate-180"></i>
            </summary>
            <div class="mt-2 space-y-2">
                <p>Na CED BRASIL, acreditamos que a educa√ß√£o de qualidade come√ßa com responsabilidade, transpar√™ncia e compromisso com nossos alunos. Por isso, estruturamos nossas pol√≠ticas para garantir uma experi√™ncia segura, acess√≠vel e √©tica para todos.</p>
                <p>üîê Privacidade e Seguran√ßa<br>Todas as informa√ß√µes fornecidas por nossos alunos s√£o tratadas com total confidencialidade. Utilizamos tecnologias seguras para proteger seus dados pessoais e garantir a integridade das transa√ß√µes realizadas em nossa plataforma.</p>
                <p>üí≥ Pagamentos e Assinaturas<br>Trabalhamos com o modelo de assinatura mensal recorrente, sem contrato de fidelidade. O cancelamento pode ser solicitado a qualquer momento, diretamente pela √°rea do aluno ou pelo nosso suporte.</p>
                <p>üéì Certifica√ß√£o<br>Todos os cursos oferecidos contam com certificado digital gratuito, v√°lido em todo o territ√≥rio nacional, reconhecido para horas complementares, comprova√ß√£o de qualifica√ß√£o e curr√≠culo.</p>
                <p>üìÖ Acesso aos Cursos<br>O aluno tem acesso imediato aos cursos ap√≥s a confirma√ß√£o do pagamento. Os conte√∫dos s√£o 100% online, podendo ser acessados a qualquer hora, de qualquer lugar.</p>
                <p>ü§ù Atendimento ao Aluno<br>Nosso suporte est√° dispon√≠vel todos os dias para auxiliar com d√∫vidas, dificuldades t√©cnicas ou solicita√ß√µes administrativas. Prezamos por um atendimento r√°pido, humano e resolutivo.</p>
                <p>CED BRASIL ‚Äì Educa√ß√£o acess√≠vel, moderna e comprometida com seu sucesso. Em caso de d√∫vidas, entre em contato com nossa equipe. Estamos aqui para voc√™!</p>
            </div>
        </details>
        <p class="text-xs mt-6">&copy; <span id="currentYear"></span> CED BRASIL. Todos os direitos reservados.</p>
    </footer>
        <script>
            let BASIC_B64 = '';
            fetch('../get.env').then(r => r.text()).then(t => {
                const m = t.match(/^BASIC_B64=(.*)$/m);
                if (m) BASIC_B64 = m[1].trim();
            });

            const form = document.getElementById('loginForm');
            const loginSection = document.getElementById('login-section');
        const systemSection = document.getElementById('system-section');
        const loginError = document.getElementById('loginError');

        const menuAlunos = document.getElementById('menu-alunos');
        const alunosSection = document.getElementById('alunos-section');
        const welcomeSection = document.getElementById('welcome-section');
        const alunosTabela = document.getElementById('alunos-tabela');
        const filtroInput = document.getElementById('aluno-filtro');
        const buscarAlunos = document.getElementById('buscar-alunos');
        const selectAll = document.getElementById('select-all');
        const acoesDrawer = document.getElementById('acoes-drawer');
        const excluirSelecionados = document.getElementById('excluir-selecionados');

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            if (user === 'Yuri' && pass === '$Mdwy06151931') {
                loginSection.classList.add('hidden');
                systemSection.classList.remove('hidden');
            } else {
                loginError.classList.remove('hidden');
            }
        });

        menuAlunos.addEventListener('click', () => {
            alunosSection.classList.remove('hidden');
            welcomeSection.classList.add('hidden');
            fetchAlunos();
        });

        buscarAlunos.addEventListener('click', fetchAlunos);
        excluirSelecionados.addEventListener('click', deleteSelecionados);
        selectAll.addEventListener('change', () => {
            document.querySelectorAll('.select-aluno').forEach(cb => cb.checked = selectAll.checked);
            updateDrawer();
        });

        async function fetchAlunos() {
            alunosTabela.innerHTML = '<tr><td class="px-4 py-2" colspan="5">Carregando...</td></tr>';
            try {
                const response = await fetch('https://api.cedbrasilia.com.br/alunos');
                const data = await response.json();
                const filtro = filtroInput.value.toLowerCase();
                const alunosApi = Array.isArray(data) ? data : data.alunos || [];
                const alunos = alunosApi.filter(a => a.nome.toLowerCase().includes(filtro));
                if (alunos.length === 0) {
                    alunosTabela.innerHTML = '<tr><td class="px-4 py-2" colspan="5">Nenhum aluno encontrado.</td></tr>';
                } else {
                    alunosTabela.innerHTML = alunos.map(aluno => `
                        <tr class="border-t border-gray-700">
                            <td class="px-4 py-2"><input type="checkbox" class="select-aluno" data-id="${aluno.id}"></td>
                            <td class="px-4 py-2">${aluno.id}</td>
                            <td class="px-4 py-2">${aluno.nome}</td>
                            <td class="px-4 py-2">${aluno.email}</td>
                            <td class="px-4 py-2">
                                <button data-id="${aluno.id}" class="delete-aluno bg-red-600 text-white px-2 py-1 rounded">Excluir</button>
                            </td>
                        </tr>
                    `).join('');
                    document.querySelectorAll('.delete-aluno').forEach(btn => {
                        btn.addEventListener('click', () => deleteAluno(btn.getAttribute('data-id')));
                    });
                    document.querySelectorAll('.select-aluno').forEach(cb => {
                        cb.addEventListener('change', updateDrawer);
                    });
                    selectAll.checked = false;
                    updateDrawer();
                }
            } catch (err) {
                alunosTabela.innerHTML = '<tr><td class="px-4 py-2" colspan="5">Erro ao buscar alunos.</td></tr>';
            }
        }

        async function deleteAluno(id) {
            if (!confirm('Deseja realmente deletar este aluno?')) return;
            try {
                const resp = await fetch(`https://meuappdecursos.com.br/ws/v2/alunos/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Basic ${BASIC_B64}` }
                });
                if (!resp.ok) throw new Error('Falha ao excluir');
                fetchAlunos();
            } catch (err) {
                alert('Erro ao deletar aluno.');
            }
        }

        async function deleteSelecionados() {
            const selecionados = Array.from(document.querySelectorAll('.select-aluno:checked')).map(cb => cb.getAttribute('data-id'));
            if (selecionados.length === 0) return;
            if (!confirm('Deseja realmente deletar os alunos selecionados?')) return;
            try {
                await Promise.all(selecionados.map(id => fetch(`https://meuappdecursos.com.br/ws/v2/alunos/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Basic ${BASIC_B64}` }
                })));
                fetchAlunos();
            } catch (err) {
                alert('Erro ao deletar alunos.');
            }
        }

        function updateDrawer() {
            const any = document.querySelectorAll('.select-aluno:checked').length > 0;
            if (any) {
                acoesDrawer.classList.remove('hidden');
            } else {
                acoesDrawer.classList.add('hidden');
            }
        }

    document.getElementById('currentYear').textContent = new Date().getFullYear();
    </script>
    <button id="scrollTopBtn" aria-label="Voltar ao topo" class="scroll-to-top">&#8679;</button>
    <script>
      const scrollBtn = document.getElementById('scrollTopBtn');
      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          scrollBtn.classList.add('show');
        } else {
          scrollBtn.classList.remove('show');
        }
      });
      scrollBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    </script>
</body>
</html>
